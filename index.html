<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>History Map</title>
    <style>
      #map { height: 80vh; width: 100%; }
      #controls { margin: 10px; }
    </style>
  </head>
  <body>
    <h1>History Map</h1>
    <div id="controls">
      <label for="start">From: </label>
      <input type="number" id="start" value="1800">
      <label for="end">To: </label>
      <input type="number" id="end" value="2000">
      <button id="loadHistory">Load History</button>
    </div>
    <div id="map"></div>
    <div id="results"></div>

    <script>
      let map, marker, lastLocation;

      function initMap() {
        map = new google.maps.Map(document.getElementById("map"), {
          center: { lat: 43.6532, lng: -79.3832 }, // Toronto default
          zoom: 5,
        });

        map.addListener("click", (event) => {
          if (marker) marker.map = null; // remove old
          marker = new google.maps.marker.AdvancedMarkerElement({
            position: event.latLng,
            map: map
          });
          lastLocation = event.latLng;
        });

        document.getElementById("loadHistory").addEventListener("click", () => {
          if (!lastLocation) {
            alert("Click on the map first!");
            return;
          }
          loadHistory(lastLocation);
        });
      }

      async function loadHistory(latLng) {
        const start = document.getElementById("start").value;
        const end = document.getElementById("end").value;

        // Example Wikidata query placeholder
        const query = `
          SELECT ?item ?itemLabel ?date WHERE {
            ?item wdt:P31/wdt:P279* wd:Q178561 .
            ?item wdt:P585 ?date .
            FILTER (?date >= "${start}-01-01T00:00:00Z"^^xsd:dateTime &&
                    ?date <= "${end}-12-31T23:59:59Z"^^xsd:dateTime)
            SERVICE wikibase:label { bd:serviceParam wikibase:language "[AUTO_LANGUAGE],en". }
          } LIMIT 10
        `;
        console.log(query);
        document.getElementById("results").innerHTML = `<p>Wikidata query placeholder. (Needs real SPARQL fetch.)</p>`;
      }
    </script>

    <script async
      src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY&callback=initMap">
    </script>
  </body>
</html>

  <!-- Google Maps API -->
  <script async
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBp_QZzDb5dPMiyWmusyZSvdLXHivD_Yq4&callback=initMap">
  </script>
</body>
</html>
