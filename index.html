<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Historical Map Explorer</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; }
    h2 { padding: 10px; background: #333; color: white; margin: 0; }
    #map { height: 70vh; width: 100%; }
    #controls { padding: 10px; background: #f4f4f4; display: flex; gap: 10px; align-items: center; }
    #results { padding: 10px; }
    .event { margin: 8px 0; padding: 8px; border-bottom: 1px solid #ccc; }
  </style>
</head>
<body>
  <h2>Historical Map Explorer</h2>
  <div id="map"></div>
  <div id="controls">
    <input type="text" id="yearFilter" placeholder="Filter by year (e.g. 1945)">
    <button id="loadHistory">Load History</button>
  </div>
  <div id="results"><h3>Click a location to begin</h3></div>

  <script>
    let map;
    let currentMarker = null;
    let selectedLocation = null;

    function initMap() {
      // Initialize map
      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: 43.6532, lng: -79.3832 }, // Toronto default
        zoom: 5,
      });

      // Place marker on click
      map.addListener("click", (event) => {
        selectedLocation = event.latLng;
        if (currentMarker) currentMarker.map = null; // remove old marker
        currentMarker = new google.maps.marker.AdvancedMarkerElement({
          position: selectedLocation,
          map: map,
        });
      });

      // Load History button
      document.getElementById("loadHistory").addEventListener("click", async () => {
        if (!selectedLocation) {
          alert("Click a location on the map first.");
          return;
        }
        await loadHistory(selectedLocation);
      });
    }

    async function loadHistory(latLng) {
      const yearFilter = document.getElementById("yearFilter").value;
      const resultsDiv = document.getElementById("results");
      resultsDiv.innerHTML = "<h3>Loading events...</h3>";

      // Placeholder: replace this with real Wikidata/SPARQL fetch later
      const dummyEvents = [
        { title: "Event A", date: "1945", link: "https://en.wikipedia.org/wiki/1945" },
        { title: "Event B", date: "1969", link: "https://en.wikipedia.org/wiki/1969" },
        { title: "Event C", date: "2000", link: "https://en.wikipedia.org/wiki/2000" }
      ];

      resultsDiv.innerHTML = "<h3>Historical Events</h3>";
      let shown = 0;
      for (let e of dummyEvents) {
        if (yearFilter && !e.date.includes(yearFilter)) continue;
        const div = document.createElement("div");
        div.className = "event";
        div.innerHTML = `<strong>${e.title}</strong> (${e.date})<br><a href="${e.link}" target="_blank">Read more</a>`;
        resultsDiv.appendChild(div);
        shown++;
      }
      if (shown === 0) resultsDiv.innerHTML += "<p>No events found.</p>";
    }
  </script>

  <!-- Google Maps JS API -->
  <script async
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCOKckKRrDdTHBhUEfB9LXEsKn-jd1GUPs&callback=initMap&v=weekly&loading=async">
  </script>
</body>
</html>
